# GitHub Actions自动化配置完整指南

## 🎉 第1步：代码已推送完成 ✅

你的GitHub Actions配置已经成功推送到仓库！

## 🔐 第2步：配置GitHub Secrets（重要）

现在需要在GitHub仓库中配置必要的密钥：

### 2.1 进入GitHub仓库设置
1. 打开你的GitHub仓库：https://github.com/mojojo-cz/primal-void-create-main
2. 点击仓库页面顶部的 **"Settings"** 选项卡
3. 在左侧菜单中点击 **"Secrets and variables"** → **"Actions"**

### 2.2 添加必要的密钥
点击 **"New repository secret"** 按钮，添加以下密钥：

#### 密钥1：SUPABASE_ANON_KEY
```
名称: SUPABASE_ANON_KEY
值: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4c3lwcnpja2RuZnloYWRvZGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1NTUyMDQsImV4cCI6MjA2MzEzMTIwNH0.7_hXOZTGPx29KGCYCgTYNLi8Ys-eHOAb0o8htiJd_Rs
```

## 🚀 第3步：自动化执行计划

### 3.1 自动执行时间表
GitHub Actions将按以下时间表自动执行：

| 执行时间（北京时间） | 执行时间（UTC） | 说明 |
|---------------------|------------------|------|
| 02:00 | 18:00 (前一天) | 深夜维护时段 |
| 08:00 | 00:00 | 早晨上班前 |
| 14:00 | 06:00 | 下午工作时段 |
| 20:00 | 12:00 | 晚上学习时段 |

### 3.2 执行内容
每次自动执行将：
- 🔍 检查所有视频URL状态
- ⚠️ 识别已过期和即将过期的URL（24小时内）
- 🔄 自动刷新需要更新的URL（7天新有效期）
- 📊 生成详细的执行报告
- 🚨 失败时发送通知

## 🧪 第4步：手动测试自动化（推荐）

### 4.1 立即测试
1. 进入GitHub仓库的 **"Actions"** 页面
2. 点击左侧的 **"视频URL定时刷新"** 工作流
3. 点击右侧的 **"Run workflow"** 下拉按钮
4. 选择执行参数：
   - **操作类型**: `refresh`（刷新）或 `check`（仅检查）
   - **批处理大小**: `50`（默认）
5. 点击 **"Run workflow"** 开始执行

### 4.2 查看执行结果
- 📄 **执行日志**: 点击具体的工作流运行查看详细日志
- 📊 **执行报告**: 在Summary页面查看格式化的执行报告
- ⚠️ **错误处理**: 失败时会显示具体的错误原因

## 📊 第5步：监控和维护

### 5.1 执行监控
- **GitHub通知**: 工作流失败时GitHub会自动发送邮件通知
- **执行历史**: 在Actions页面查看所有执行历史和结果
- **状态徽章**: 可在README中添加状态徽章显示运行状态

### 5.2 故障排除
如果自动化执行失败，可能的原因：

| 问题 | 症状 | 解决方案 |
|------|------|----------|
| Secrets未配置 | 401认证错误 | 检查SUPABASE_ANON_KEY配置 |
| Edge Function错误 | 500服务器错误 | 检查Edge Function部署状态 |
| MinIO连接失败 | 网络连接错误 | 检查MinIO服务器状态 |
| 配额限制 | 执行被跳过 | 检查GitHub Actions使用配额 |

### 5.3 维护建议
- 📅 **定期检查**: 每周查看一次执行历史
- 🔧 **性能调优**: 根据执行时间调整批处理大小
- 📈 **监控指标**: 关注刷新成功率和失败率
- 🚨 **预警设置**: 配置失败通知机制

## 🎯 第6步：验证自动化效果

### 6.1 预期效果
配置完成后，你应该看到：
- ✅ 每6小时自动执行一次URL刷新
- ✅ 用户访问视频时不会遇到URL过期问题
- ✅ 管理员控制台显示最新的URL状态
- ✅ 系统运行更加稳定和可靠

### 6.2 成功指标
- **URL可用性**: 99%以上的视频URL保持有效
- **用户体验**: 用户访问视频无延迟或错误
- **执行成功率**: 95%以上的自动化任务成功执行
- **维护工作量**: 几乎无需手动干预

## 🔄 替代方案（可选）

如果GitHub Actions不满足需求，还可以选择：

### 方案1：Vercel Cron（如果使用Vercel部署）
- 集成度高，配置简单
- 免费配额充足
- 适合已使用Vercel的项目

### 方案2：UptimeRobot
- 专业的网站监控服务
- 免费版每5分钟检查一次
- 可以配置为调用你的Edge Function

### 方案3：EasyCron.com
- 专业的Cron服务
- 精确的时间控制
- 付费服务，但功能强大

## 📋 操作清单

### 必须完成：
- [ ] ✅ 代码已推送到GitHub
- [ ] 🔐 在GitHub中配置SUPABASE_ANON_KEY密钥
- [ ] 🧪 手动测试工作流执行
- [ ] 📊 验证执行结果和报告

### 可选优化：
- [ ] 📧 配置失败通知邮箱
- [ ] 📈 添加监控仪表板
- [ ] 🔔 设置手机通知
- [ ] 📝 建立维护文档

## 🎉 完成确认

当你完成所有必须步骤后，自动化系统将：
- 🤖 每6小时自动检查和刷新视频URL
- 📊 生成详细的执行报告
- 🚨 在失败时自动通知
- 💯 确保用户获得最佳的视频访问体验

现在你只需要配置GitHub Secrets，然后就可以享受全自动的视频URL管理了！🚀 