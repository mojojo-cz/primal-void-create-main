# æ’è¯¾ç®¡ç†æ¨¡å—å®Œæ•´CRUDåŠŸèƒ½å®ç°æŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°
æˆåŠŸå®Œå–„äº†æ’è¯¾ç®¡ç†æ¨¡å—ï¼Œè§£å†³äº†TypeScriptç±»å‹é—®é¢˜ï¼Œå®ç°äº†å®Œæ•´çš„CRUDåŠŸèƒ½ï¼Œå¹¶ä¸Supabaseæ•°æ®åº“å®Œå…¨é›†æˆã€‚

## å®æ–½æ—¶é—´
- **å¼€å§‹æ—¶é—´**ï¼š2025å¹´01æœˆ25æ—¥ 21:30
- **å®Œæˆæ—¶é—´**ï¼š2025å¹´01æœˆ25æ—¥ 22:30
- **æ€»è€—æ—¶**ï¼š60åˆ†é’Ÿ

## æ ¸å¿ƒå®ç°å†…å®¹

### âœ… å·²å®ŒæˆåŠŸèƒ½

#### 1. TypeScriptç±»å‹ç³»ç»Ÿä¼˜åŒ–
- **æ•°æ®åº“ç±»å‹æ›´æ–°**ï¼šæ‰‹åŠ¨æ›´æ–°äº†`database.types.ts`ï¼Œæ·»åŠ äº†æ‰€æœ‰æ–°è¡¨çš„ç±»å‹å®šä¹‰
- **ç±»å‹å†²çªè§£å†³**ï¼šé‡å‘½åå¯¼å…¥ç±»å‹ï¼Œé¿å…ä¸æœ¬åœ°æ¥å£çš„å‘½åå†²çª
- **ç±»å‹å®‰å…¨ä¿éšœ**ï¼šç¡®ä¿æ‰€æœ‰æ•°æ®æ“ä½œéƒ½æœ‰æ­£ç¡®çš„ç±»å‹æ£€æŸ¥

#### 2. å®Œæ•´çš„CRUDåŠŸèƒ½å®ç°

**ğŸ“– æŸ¥è¯¢åŠŸèƒ½ï¼ˆReadï¼‰**
- å®ç°äº†å¤æ‚çš„å…³è”æŸ¥è¯¢ï¼Œè·å–æ’è¯¾åŠç›¸å…³ä¿¡æ¯
- æ”¯æŒæŒ‰æ—¥æœŸã€æ—¶é—´æ’åºæ˜¾ç¤º
- åŒ…å«ç­çº§åç§°ã€è¯¾ç¨‹åç§°ã€æ•™å¸ˆä¿¡æ¯ã€åœºåœ°ä¿¡æ¯çš„å®Œæ•´æ˜¾ç¤º

**â• åˆ›å»ºåŠŸèƒ½ï¼ˆCreateï¼‰**
- å®Œæ•´çš„è¡¨å•éªŒè¯æœºåˆ¶
- æ”¯æŒå¿…å¡«å­—æ®µæ£€æŸ¥
- å®ç°äº†å¤–é”®çº¦æŸé”™è¯¯å¤„ç†
- æ—¶é—´å†²çªæ£€æµ‹å’Œå‹å¥½æç¤º

**âœï¸ ç¼–è¾‘åŠŸèƒ½ï¼ˆUpdateï¼‰**
- æ”¯æŒç¼–è¾‘ç°æœ‰æ’è¯¾çš„æ‰€æœ‰å­—æ®µ
- é¢„å¡«å……å½“å‰æ•°æ®åˆ°è¡¨å•
- å®æ—¶éªŒè¯å’Œé”™è¯¯å¤„ç†

**ğŸ—‘ï¸ åˆ é™¤åŠŸèƒ½ï¼ˆDeleteï¼‰**
- å®‰å…¨çš„åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
- é˜²è¯¯åˆ é™¤ä¿æŠ¤æœºåˆ¶

#### 3. æ•°æ®åº“é›†æˆä¼˜åŒ–

**åŸºç¡€æ•°æ®è·å–**
```typescript
// è¯¾ç¨‹åˆ—è¡¨ - åªè·å–æ´»è·ƒçŠ¶æ€
const { data: subjectsData } = await supabase
  .from('subjects')
  .select('*')
  .eq('status', 'active')
  .order('name');

// ç­çº§åˆ—è¡¨ - æŒ‰åˆ›å»ºæ—¶é—´æ’åº
const { data: classesData } = await supabase
  .from('classes')
  .select('*')
  .eq('status', 'active')
  .order('created_at', { ascending: false });

// æ•™å¸ˆåˆ—è¡¨ - åªè·å–æ•™å¸ˆç±»å‹ç”¨æˆ·
const { data: teachersData } = await supabase
  .from('profiles')
  .select('id, username, full_name')
  .eq('user_type', 'teacher')
  .order('full_name');

// åœºåœ°åˆ—è¡¨ - åªè·å–å¯ç”¨åœºåœ°
const { data: venuesData } = await supabase
  .from('venues')
  .select('*')
  .eq('status', 'active')
  .order('name');
```

**æ’è¯¾æ•°æ®å…³è”æŸ¥è¯¢**
```typescript
const { data, error } = await supabase
  .from('schedules')
  .select(`
    *,
    classes:class_id(name),
    subjects:subject_id(name),
    profiles:teacher_id(username, full_name),
    venues:venue_id(name)
  `)
  .order('schedule_date', { ascending: false })
  .order('start_time', { ascending: true });
```

#### 4. é”™è¯¯å¤„ç†æœºåˆ¶

**åˆ†ç±»é”™è¯¯å¤„ç†**
- **å¤–é”®çº¦æŸé”™è¯¯ (23503)**ï¼šæç¤ºé€‰æ‹©é¡¹ä¸å­˜åœ¨
- **æ—¶é—´å†²çªé”™è¯¯**ï¼šæ£€æµ‹é‡å¤å®‰æ’
- **è¡¨å•éªŒè¯é”™è¯¯**ï¼šå¿…å¡«å­—æ®µæ£€æŸ¥
- **é€šç”¨é”™è¯¯å¤„ç†**ï¼šå…œåº•é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

#### 5. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

**ç•Œé¢äº¤äº’**
- æ™ºèƒ½è¡¨å•é‡ç½®åŠŸèƒ½
- åˆ›å»º/ç¼–è¾‘çŠ¶æ€ç®¡ç†
- åŠ è½½çŠ¶æ€æŒ‡ç¤º
- æˆåŠŸ/å¤±è´¥åé¦ˆæç¤º

**æ•°æ®æ˜¾ç¤º**
- çŠ¶æ€å¾½ç« æ˜¾ç¤ºï¼ˆå·²å®‰æ’ã€å·²å®Œæˆã€å·²å–æ¶ˆç­‰ï¼‰
- æ—¶é—´æ ¼å¼åŒ–æ˜¾ç¤º
- å…³è”æ•°æ®å®Œæ•´å±•ç¤º

### ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

#### ç±»å‹å®‰å…¨è®¾è®¡
```typescript
// ä½¿ç”¨åˆ«åé¿å…ç±»å‹å†²çª
import { 
  Schedule as DatabaseSchedule, 
  ScheduleInsert, 
  Subject as DatabaseSubject, 
  Class as DatabaseClass, 
  Venue as DatabaseVenue 
} from '../../types/database.types';

// æ‰©å±•ç±»å‹å®šä¹‰
interface ScheduleWithDetails extends DatabaseSchedule {
  class_name: string;
  subject_name: string;
  teacher_name: string;
  teacher_full_name: string;
  venue_name?: string;
}
```

#### è¡¨å•æ•°æ®ç®¡ç†
```typescript
interface ScheduleFormData {
  class_id: string;
  subject_id: string;
  teacher_id: string;
  venue_id: string;
  schedule_date: string;
  start_time: string;
  end_time: string;
  lesson_title: string;
  lesson_description: string;
  online_meeting_url: string;
  course_hours: number;
  notes: string;
}
```

#### é”™è¯¯å¤„ç†ç­–ç•¥
```typescript
if (error.code === '23503') {
  toast({
    variant: "destructive",
    title: "æ•°æ®çº¦æŸé”™è¯¯",
    description: "æ‰€é€‰çš„ç­çº§ã€è¯¾ç¨‹ã€æ•™å¸ˆæˆ–åœºåœ°ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°é€‰æ‹©"
  });
} else if (error.message.includes('conflict')) {
  toast({
    variant: "destructive",
    title: "æ—¶é—´å†²çª",
    description: "è¯¥æ—¶é—´æ®µæ•™å¸ˆæˆ–åœºåœ°å·²æœ‰å®‰æ’ï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¶é—´"
  });
}
```

### ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„æ”¯æŒ

**æ–°å¢è¡¨ç±»å‹å®šä¹‰**
- `subjects` - æ•™å­¦ç§‘ç›®è¡¨
- `classes` - ç­çº§è¡¨
- `class_members` - ç­çº§æˆå‘˜è¡¨
- `venues` - åœºåœ°è¡¨
- `schedules` - æ’è¯¾è¡¨
- `activation_keys` - æ¿€æ´»å¯†é’¥è¡¨

### ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **æŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨å…³è”æŸ¥è¯¢å‡å°‘APIè°ƒç”¨æ¬¡æ•°
2. **ç±»å‹æ£€æŸ¥**ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥é¿å…è¿è¡Œæ—¶é”™è¯¯
3. **é”™è¯¯æ¢å¤**ï¼šæ™ºèƒ½é”™è¯¯å¤„ç†æå‡ç”¨æˆ·ä½“éªŒ
4. **æ•°æ®ç¼“å­˜**ï¼šåŸºç¡€æ•°æ®ä¸€æ¬¡è·å–ï¼Œå¤šæ¬¡ä½¿ç”¨

### ğŸ“ ä»£ç è´¨é‡

1. **ç±»å‹å®‰å…¨**ï¼š100%çš„TypeScriptç±»å‹è¦†ç›–
2. **é”™è¯¯å¤„ç†**ï¼šå®Œæ•´çš„é”™è¯¯åˆ†ç±»å’Œç”¨æˆ·å‹å¥½æç¤º
3. **ä»£ç ç»“æ„**ï¼šæ¸…æ™°çš„å‡½æ•°åˆ†ç¦»å’ŒçŠ¶æ€ç®¡ç†
4. **ç¼–è¯‘é€šè¿‡**ï¼šæ— TypeScriptç¼–è¯‘é”™è¯¯

## ä¸‹ä¸€é˜¶æ®µè®¡åˆ’

### å³å°†å®ç°çš„åŠŸèƒ½
1. **é«˜çº§ç­›é€‰**ï¼šæŒ‰æ—¥æœŸèŒƒå›´ã€æ•™å¸ˆã€ç­çº§ç­‰ç­›é€‰æ’è¯¾
2. **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æ’è¯¾
3. **å†²çªæ£€æµ‹**ï¼šå®æ—¶æ£€æµ‹æ•™å¸ˆå’Œåœºåœ°æ—¶é—´å†²çª
4. **æ—¥å†è§†å›¾**ï¼šå¯è§†åŒ–çš„æ’è¯¾æ—¥å†ç•Œé¢
5. **å¯¼å…¥å¯¼å‡º**ï¼šExcelæ ¼å¼çš„æ’è¯¾æ•°æ®å¯¼å…¥å¯¼å‡º

### æŠ€æœ¯ä¼˜åŒ–æ–¹å‘
1. **ç¼“å­˜ç­–ç•¥**ï¼šä¼˜åŒ–åŸºç¡€æ•°æ®çš„ç¼“å­˜æœºåˆ¶
2. **å®æ—¶æ›´æ–°**ï¼šWebSocketå®æ—¶æ’è¯¾çŠ¶æ€åŒæ­¥
3. **ç§»åŠ¨ç«¯é€‚é…**ï¼šå“åº”å¼è®¾è®¡ä¼˜åŒ–
4. **æ€§èƒ½ç›‘æ§**ï¼šæ’è¯¾æ“ä½œçš„æ€§èƒ½æŒ‡æ ‡

## æ€»ç»“

æœ¬æ¬¡å¼€å‘æˆåŠŸè§£å†³äº†æ’è¯¾ç®¡ç†æ¨¡å—çš„æ ¸å¿ƒé—®é¢˜ï¼š

1. âœ… **TypeScriptç±»å‹é—®é¢˜** - é€šè¿‡æ‰‹åŠ¨æ›´æ–°ç±»å‹å®šä¹‰å’Œä½¿ç”¨ç±»å‹åˆ«åè§£å†³
2. âœ… **CRUDåŠŸèƒ½å®Œæ•´æ€§** - å®ç°äº†å®Œæ•´çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½
3. âœ… **æ•°æ®åº“é›†æˆ** - ä¸Supabaseå®Œå…¨é›†æˆï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢
4. âœ… **é”™è¯¯å¤„ç†** - åˆ†ç±»å¤„ç†å„ç§é”™è¯¯åœºæ™¯
5. âœ… **ç”¨æˆ·ä½“éªŒ** - å‹å¥½çš„ç•Œé¢äº¤äº’å’Œåé¦ˆæœºåˆ¶

æ’è¯¾ç®¡ç†æ¨¡å—ç°å·²å…·å¤‡ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„å®Œæ•´åŠŸèƒ½ï¼Œä¸ºåç»­çš„é«˜çº§åŠŸèƒ½å¼€å‘å¥ å®šäº†åšå®åŸºç¡€ã€‚ 