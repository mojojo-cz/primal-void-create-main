# 考研线上教育平台 - 完整测试用例 

## 📊 项目概况

**项目名称：** 考研线上教育平台 - 综合性在线教育系统  
**技术栈：** React + TypeScript + Supabase + MinIO + Tailwind CSS  
**用户类型：** 7种用户类型，7级权限体系  
**核心模块：** 8大功能模块，涵盖教育管理全流程  

---

## 🎯 测试策略概述

### 测试目标
1. **功能完整性验证** - 确保所有功能按预期工作
2. **用户权限边界测试** - 验证7种用户类型的权限隔离
3. **数据一致性检查** - 确保复杂业务逻辑的数据完整性
4. **性能压力测试** - 识别系统瓶颈和优化点
5. **安全漏洞发现** - 验证认证授权和数据安全
6. **用户体验验证** - 发现界面和交互问题

### 测试分类
- **单元测试** - 组件和函数级别
- **集成测试** - 模块间交互
- **系统测试** - 端到端流程
- **边界测试** - 极限条件和异常场景
- **兼容性测试** - 跨浏览器和设备
- **性能测试** - 负载和压力测试

---

## 🔐 用户权限系统测试

### 1. 用户类型权限边界测试

#### 1.1 注册用户权限测试 (registered - 30天)
```
测试用例ID: AUTH_001
测试目标: 验证注册用户权限边界
测试步骤:
1. 创建注册用户账号
2. 尝试访问各个功能模块
3. 验证权限限制是否正确
4. 测试30天过期机制

预期结果:
- ✅ 可以访问基础功能
- ❌ 不能访问高级功能
- ❌ 不能管理其他用户
- ⚠️ 接近30天时收到续费提醒

边界条件测试:
- 注册第29天23:59:59时的访问
- 注册第30天00:00:01时的访问
- 激活密钥升级边界测试
```

#### 1.2 权限提升测试
```
测试用例ID: AUTH_002  
测试目标: 验证用户类型提升流程
测试步骤:
1. registered → trial_user (激活密钥)
2. trial_user → student (激活密钥)  
3. 管理员直接提升权限
4. 验证权限变更后的功能访问

潜在Bug发现点:
- 权限提升后旧权限是否立即失效
- 有效期是否正确计算和更新
- 用户界面是否正确反映新权限
- 缓存是否及时更新
```

#### 1.3 多设备登录权限测试
```
测试用例ID: AUTH_003
测试目标: 验证多设备同时登录的权限一致性
测试步骤:
1. 同一账号在PC和手机同时登录
2. 在一个设备上修改个人信息
3. 在另一个设备上验证信息同步
4. 权限变更是否在所有设备生效

预期Bug发现:
- 权限状态不同步
- 数据缓存不一致
- 登录状态异常
```

### 2. 权限级联测试

#### 2.1 班主任权限继承测试
```
测试用例ID: AUTH_004
测试目标: 验证班主任只能管理指定班级
测试步骤:
1. 创建两个班级：班级A、班级B
2. 设置班主任只管理班级A
3. 尝试在班级B中添加/删除学员
4. 验证数据过滤和权限隔离

重点检查:
- RLS(Row Level Security)策略是否生效
- 前端界面是否正确过滤数据
- API调用是否被正确拦截
```

#### 2.2 业务老师权限限制测试
```
测试用例ID: AUTH_005
测试目标: 验证业务老师只能管理特定用户类型
测试步骤:
1. 业务老师尝试管理各种用户类型
2. 验证只能管理registered和trial_user
3. 测试激活密钥生成权限限制
4. 验证账号升级权限边界

预期发现:
- 权限绕过漏洞
- 界面权限与后端权限不一致
- 错误处理不友好
```

---

## 📚 核心功能模块测试

### 3. 课程管理系统测试

#### 3.1 章节-考点两层结构测试
```
测试用例ID: COURSE_001
测试目标: 验证课程结构完整性
测试步骤:
1. 创建课程 → 添加章节 → 添加考点
2. 测试删除章节时考点的级联删除
3. 验证章节排序和考点排序
4. 测试考点与视频的关联

边界条件:
- 空章节删除处理
- 考点与视频关联断开
- 大量章节和考点的性能
- 并发编辑冲突
```

#### 3.2 视频关联完整性测试
```
测试用例ID: COURSE_002
测试目标: 验证视频与考点关联的数据一致性
测试步骤:
1. 创建考点并关联视频
2. 删除视频，验证考点处理
3. 修改视频信息，验证考点同步
4. 批量操作的数据完整性

潜在Bug:
- 外键约束错误处理
- 孤儿数据产生
- 删除操作的级联问题
```

### 4. 视频管理系统测试

#### 4.1 MinIO视频播放URL缓存测试
```
测试用例ID: VIDEO_001
测试目标: 验证7天有效期URL和10小时缓冲策略
测试步骤:
1. 上传视频，验证play_url生成
2. 模拟时间推进，测试URL过期检测
3. 验证10小时缓冲策略触发
4. 测试长视频播放中断问题

关键测试点:
- URL过期时间计算精确性
- 预加载缓存过期检查
- 播放中URL过期的处理
- 数据库URL更新一致性

模拟场景:
- 视频播放到第8小时时URL过期
- 预加载的URL已过期但被使用
- 网络异常时的重试机制
```

#### 4.2 视频预加载机制测试
```
测试用例ID: VIDEO_002
测试目标: 验证智能预加载策略
测试步骤:
1. 渐进式预加载(前3个视频)
2. 自适应预加载(70%进度触发)
3. 延迟缓存(20秒后全部)
4. 预加载URL过期处理

预期Bug发现:
- 预加载缓存污染
- 内存泄漏问题
- 网络请求过多
- 缓存失效处理不当
```

#### 4.3 视频播放状态一致性测试
```
测试用例ID: VIDEO_003
测试目标: 验证播放进度和完成状态
测试步骤:
1. 测试99%完成阈值逻辑
2. 验证断点续播功能
3. 多设备播放进度同步
4. 倒计时功能异常处理

边界条件:
- 播放进度99.5%的处理
- 网络中断时进度保存
- 快进到结尾的状态判断
```

### 5. 排课管理系统测试

#### 5.1 冲突检测算法测试
```
测试用例ID: SCHEDULE_001
测试目标: 验证教师和教室冲突检测
测试步骤:
1. 创建时间重叠的排课
2. 测试教师时间冲突检测
3. 测试教室资源冲突检测
4. 验证跨课表的全局冲突检测

复杂场景:
- 同一教师在不同课表的冲突
- 教室在同一时间的多重预约
- 时间边界重叠(09:30-10:30 vs 10:30-11:30)
- 夏令时/冬令时的时间计算

测试数据:
课程A: 2025-02-01 09:00-10:30 教师001 教室A101
课程B: 2025-02-01 10:00-11:30 教师001 教室B201 (教师冲突)
课程C: 2025-02-01 09:30-11:00 教师002 教室A101 (教室冲突)
```

#### 5.2 智能排课工作台测试
```
测试用例ID: SCHEDULE_002
测试目标: 验证批量排课和预览功能
测试步骤:
1. 创建课表计划
2. 批量生成排课(重复时间模式)
3. 预览列表冲突检测
4. 最终保存和数据一致性

性能测试:
- 一次性创建100节课的性能
- 冲突检测算法的复杂度
- 大量数据的前端渲染性能
```

#### 5.3 日期验证系统测试
```
测试用例ID: SCHEDULE_003
测试目标: 验证日期验证逻辑
测试步骤:
1. 尝试创建过去日期的排课
2. 测试历史课程信息编辑
3. 验证日期格式和时区处理
4. 跨年度排课处理

边界条件:
- 创建今天00:00:01的排课
- 创建昨天23:59:59的排课
- 修改历史排课的标题(非日期字段)
- 时区转换的精确性
```

### 6. 激活密钥系统测试

#### 6.1 密钥生成和验证测试
```
测试用例ID: KEY_001
测试目标: 验证16位密钥格式和唯一性
测试步骤:
1. 批量生成10000个密钥
2. 验证格式(XXXX-XXXX-XXXX-XXXX)
3. 检查重复性
4. 测试密钥有效性验证

统计分析:
- 密钥随机性分布
- 重复概率计算
- 格式验证的边界情况
```

#### 6.2 密钥权限分离测试
```
测试用例ID: KEY_002
测试目标: 验证不同角色的密钥生成权限
测试数据:
管理员: 可生成 upgrade_to_trial, upgrade_to_student
班主任: 可生成 upgrade_to_student
业务老师: 可生成 upgrade_to_trial

测试步骤:
1. 各角色尝试生成所有类型密钥
2. 验证权限检查的严格性
3. 测试权限绕过攻击
```

#### 6.3 密钥使用状态测试
```
测试用例ID: KEY_003
测试目标: 验证密钥使用状态和追踪
测试步骤:
1. 正常使用密钥升级账号
2. 尝试重复使用同一密钥
3. 验证使用记录的完整性
4. 测试密钥过期机制

边界条件:
- 同时使用同一密钥
- 网络中断时的状态处理
- 密钥使用的并发安全
```

---

## 🏢 班级管理系统测试

### 7. 多对多关系测试

#### 7.1 学员-班级关系测试
```
测试用例ID: CLASS_001
测试目标: 验证一个学员可在多个班级
测试步骤:
1. 学员A加入班级1、班级2、班级3
2. 验证各班级的学员列表
3. 测试学员退出某个班级
4. 验证课表显示的正确性

数据一致性检查:
- class_members表的状态一致性
- 学员课表的正确合并
- 班级统计数据的准确性
```

#### 7.2 班级容量限制测试
```
测试用例ID: CLASS_002
测试目标: 验证班级最大学员数限制
测试步骤:
1. 创建最大30人的班级
2. 添加31个学员
3. 验证容量限制处理
4. 测试容量调整的影响

边界测试:
- 恰好达到容量上限
- 超出容量的处理方式
- 容量调整后的数据处理
```

### 8. 权限分离测试

#### 8.1 班主任权限隔离测试
```
测试用例ID: CLASS_003
测试目标: 验证班主任只能管理指定班级
测试步骤:
1. 班主任A管理班级1
2. 班主任B管理班级2
3. A尝试操作班级2的学员
4. 验证数据隔离和错误处理

权限绕过测试:
- API直接调用绕过
- URL参数篡改
- 前端权限检查绕过
```

---

## 📊 学习进度系统测试

### 9. 进度追踪精确性测试

#### 9.1 播放进度计算测试
```
测试用例ID: PROGRESS_001
测试目标: 验证播放进度计算的精确性
测试步骤:
1. 播放10分钟视频到第5分钟
2. 验证50%进度计算
3. 测试快进/快退对进度的影响
4. 验证网络中断时的进度保存

精确性测试:
- 秒级精度的进度保存
- 多次暂停/播放的累积
- 倍速播放时的进度计算
```

#### 9.2 断点续播测试
```
测试用例ID: PROGRESS_002
测试目标: 验证跨设备断点续播
测试步骤:
1. PC播放到第5分钟暂停
2. 手机端继续播放
3. 验证进度同步准确性
4. 测试多设备并发播放

同步测试:
- 实时进度同步延迟
- 冲突解决策略
- 离线播放进度合并
```

### 10. 学习状态管理测试

#### 10.1 课程完成状态测试
```
测试用例ID: PROGRESS_003
测试目标: 验证课程完成状态逻辑
测试步骤:
1. 完成所有考点视频
2. 验证课程完成状态更新
3. 测试部分完成的状态显示
4. 验证证书生成逻辑

状态转换测试:
- 未开始 → 学习中 → 已完成
- 状态回退的处理
- 状态变化的通知机制
```

---

## 🏗️ 系统级集成测试

### 11. 数据一致性测试

#### 11.1 跨模块数据一致性
```
测试用例ID: INTEGRATION_001
测试目标: 验证模块间数据同步
测试场景:
1. 删除课程时相关排课的处理
2. 删除用户时各模块数据清理
3. 修改班级信息时排课的同步
4. 视频删除时考点关联的处理

测试方法:
- 事务一致性检查
- 外键约束验证
- 级联操作正确性
- 数据孤儿检测
```

#### 11.2 并发操作测试
```
测试用例ID: INTEGRATION_002
测试目标: 验证高并发场景的数据一致性
测试场景:
1. 多用户同时编辑同一课程
2. 并发激活同一密钥
3. 同时创建冲突的排课
4. 多设备同步播放进度

并发测试工具:
- 模拟100个并发用户
- 压力测试数据库锁
- 事务隔离级别验证
```

### 12. 性能压力测试

#### 12.1 大数据量测试
```
测试用例ID: PERFORMANCE_001
测试目标: 验证系统在大数据量下的性能
测试数据:
- 10000个用户
- 1000门课程
- 50000个视频
- 100000条学习记录

性能指标:
- 页面加载时间 < 3秒
- API响应时间 < 500ms
- 数据库查询时间 < 100ms
- 内存使用 < 512MB
```

#### 12.2 高并发测试
```
测试用例ID: PERFORMANCE_002
测试目标: 验证高并发用户访问
测试场景:
- 1000用户同时登录
- 500用户同时观看视频
- 100管理员同时创建排课
- 50用户同时激活密钥

压力测试指标:
- 系统响应时间变化
- 错误率统计
- 资源使用监控
- 数据库连接池状态
```

---

## 🔒 安全性测试

### 13. 认证授权安全测试

#### 13.1 权限绕过攻击测试
```
测试用例ID: SECURITY_001
测试目标: 发现权限绕过漏洞
攻击场景:
1. 直接API调用绕过前端权限检查
2. JWT Token篡改攻击
3. 会话固定攻击
4. 权限提升攻击

测试方法:
- 修改HTTP请求参数
- 篡改认证Token
- 跨用户会话攻击
- 时间竞争攻击
```

#### 13.2 数据安全测试
```
测试用例ID: SECURITY_002
测试目标: 验证敏感数据保护
测试项目:
1. 密码存储安全性
2. 个人信息脱敏
3. 日志信息安全
4. 数据传输加密

安全检查:
- SQL注入攻击
- XSS跨站脚本攻击
- CSRF跨站请求伪造
- 文件上传安全
```

### 14. 业务逻辑安全测试

#### 14.1 激活密钥安全测试
```
测试用例ID: SECURITY_003
测试目标: 验证激活密钥系统安全
攻击场景:
1. 暴力破解密钥
2. 密钥重复使用
3. 批量生成密钥攻击
4. 时间竞争使用密钥

防护验证:
- 密钥生成随机性
- 使用状态原子性
- 权限检查严格性
```

---

## 🖥️ 用户界面测试

### 15. 响应式设计测试

#### 15.1 跨设备兼容性测试
```
测试用例ID: UI_001
测试目标: 验证多设备适配
测试设备:
- 桌面端: 1920x1080, 1366x768
- 平板端: 768x1024, 1024x768
- 手机端: 375x667, 414x896
- 超宽屏: 2560x1440

测试项目:
- 布局适应性
- 触摸操作友好性
- 文字大小可读性
- 按钮点击区域大小
```

#### 15.2 浏览器兼容性测试
```
测试用例ID: UI_002
测试目标: 验证跨浏览器兼容性
测试浏览器:
- Chrome (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- Edge (最新版本)
- 移动浏览器

功能测试:
- 视频播放兼容性
- 文件上传功能
- WebSocket连接
- 本地存储功能
```

### 16. 用户体验测试

#### 16.1 加载性能测试
```
测试用例ID: UX_001
测试目标: 验证页面加载体验
测试指标:
- 首屏加载时间
- 白屏时间
- 可交互时间
- 资源加载完成时间

优化验证:
- 骨架屏显示
- 懒加载实现
- 缓存策略效果
- 错误状态处理
```

#### 16.2 交互反馈测试
```
测试用例ID: UX_002
测试目标: 验证用户操作反馈
测试项目:
- 点击响应延迟
- 加载状态显示
- 错误提示友好性
- 成功反馈清晰度

体验检查:
- 操作确认机制
- 撤销操作支持
- 键盘导航支持
- 无障碍访问
```

---

## 🚨 边界条件和异常测试

### 17. 极限条件测试

#### 17.1 数据边界测试
```
测试用例ID: BOUNDARY_001
测试目标: 验证数据边界处理
测试场景:
1. 用户名: 空值、1字符、50字符、51字符
2. 课程标题: 空值、最大长度、特殊字符
3. 视频文件: 0KB、50GB、格式错误
4. 班级容量: 0人、1人、10000人

边界数据:
- 最小值-1, 最小值, 最小值+1
- 最大值-1, 最大值, 最大值+1
- 空值、null、undefined
- 特殊字符和emoji
```

#### 17.2 网络异常测试
```
测试用例ID: BOUNDARY_002
测试目标: 验证网络异常处理
测试场景:
1. 网络中断时的操作
2. 慢网络环境
3. 间歇性连接问题
4. 服务器无响应

异常模拟:
- 断网重连测试
- 超时处理测试
- 重试机制测试
- 离线模式测试
```

### 18. 错误处理测试

#### 18.1 系统错误恢复测试
```
测试用例ID: ERROR_001
测试目标: 验证系统错误恢复能力
错误场景:
1. 数据库连接失败
2. 文件服务器异常
3. 内存不足
4. 磁盘空间不足

恢复机制:
- 自动重试逻辑
- 降级服务模式
- 用户友好提示
- 数据完整性保护
```

#### 18.2 用户输入错误测试
```
测试用例ID: ERROR_002
测试目标: 验证用户输入错误处理
错误输入:
1. SQL注入字符串
2. XSS攻击代码
3. 超长文本输入
4. 无效数据格式

处理验证:
- 输入验证严格性
- 错误提示准确性
- 安全防护有效性
- 用户体验友好性
```

---

## 📋 测试执行计划

### 19. 自动化测试框架

#### 19.1 单元测试框架
```javascript
// 示例: 用户权限验证测试
describe('用户权限验证', () => {
  test('注册用户权限边界测试', async () => {
    const user = createTestUser('registered');
    
    // 测试允许的操作
    expect(await user.viewCourses()).toBeTruthy();
    expect(await user.updateProfile()).toBeTruthy();
    
    // 测试禁止的操作
    expect(await user.createCourse()).toBeFalsy();
    expect(await user.manageUsers()).toBeFalsy();
  });
  
  test('权限提升流程测试', async () => {
    const user = createTestUser('registered');
    const activationKey = generateTestKey('upgrade_to_student');
    
    await user.useActivationKey(activationKey);
    
    expect(user.userType).toBe('student');
    expect(user.accessExpiresAt).toBeCloseTo(addYears(new Date(), 3));
  });
});
```

#### 19.2 集成测试框架
```javascript
// 示例: 视频播放集成测试
describe('视频播放系统集成测试', () => {
  test('视频URL缓存机制测试', async () => {
    const video = await uploadTestVideo();
    
    // 验证初始URL生成
    expect(video.play_url).toBeTruthy();
    expect(video.play_url_expires_at).toBeTruthy();
    
    // 模拟时间推进，测试URL更新
    mockTime.advance(6.5 * 24 * 60 * 60 * 1000); // 6.5天
    
    const updatedVideo = await playVideo(video.id);
    expect(updatedVideo.play_url).not.toBe(video.play_url);
  });
});
```

### 20. 测试数据管理

#### 20.1 测试数据构建
```sql
-- 测试用户数据
INSERT INTO profiles (username, user_type, access_expires_at) VALUES
('test_registered', 'registered', NOW() + INTERVAL '30 days'),
('test_student', 'student', NOW() + INTERVAL '3 years'),
('test_teacher', 'teacher', NOW() + INTERVAL '20 years'),
('test_head_teacher', 'head_teacher', NOW() + INTERVAL '20 years'),
('test_admin', 'admin', '2099-12-31 23:59:59');

-- 测试课程数据
INSERT INTO courses (title, status) VALUES
('测试课程A', 'published'),
('测试课程B', 'draft'),
('测试课程C', 'archived');

-- 测试班级数据
INSERT INTO classes (name, max_students, head_teacher_id) VALUES
('测试班级1', 30, (SELECT id FROM profiles WHERE username = 'test_head_teacher')),
('测试班级2', 50, (SELECT id FROM profiles WHERE username = 'test_head_teacher'));
```

#### 20.2 测试环境配置
```yaml
# 测试环境配置
test_config:
  database:
    url: "postgresql://test_user:test_pass@localhost:5432/test_db"
    reset_before_tests: true
    
  supabase:
    url: "https://test-project.supabase.co"
    anon_key: "test_anon_key"
    
  minio:
    endpoint: "localhost:9000"
    access_key: "test_access_key"
    secret_key: "test_secret_key"
    bucket: "test-videos"
    
  test_data:
    generate_users: 1000
    generate_courses: 100
    generate_videos: 500
```

---

## 🎯 优先级测试计划

### 高优先级 (P0) - 核心功能
1. **用户认证登录** (AUTH_001-005)
2. **视频播放核心** (VIDEO_001-002)
3. **课程访问权限** (COURSE_001-002)
4. **数据安全保护** (SECURITY_001-003)

### 中优先级 (P1) - 重要功能  
1. **排课冲突检测** (SCHEDULE_001-003)
2. **班级权限隔离** (CLASS_001-003)
3. **学习进度追踪** (PROGRESS_001-003)
4. **系统性能优化** (PERFORMANCE_001-002)

### 低优先级 (P2) - 体验优化
1. **界面响应式设计** (UI_001-002)
2. **错误处理优化** (ERROR_001-002)
3. **边界条件处理** (BOUNDARY_001-002)
4. **用户体验提升** (UX_001-002)

---

## 📊 测试报告模板

### 测试执行报告
```
测试执行时间: 2025-01-XX 至 2025-01-XX
测试环境: 测试环境/预生产环境
测试覆盖率: XX%

测试结果统计:
- 通过: XXX 个测试用例
- 失败: XXX 个测试用例  
- 阻塞: XXX 个测试用例
- 跳过: XXX 个测试用例

发现Bug统计:
- 严重 (Critical): X 个
- 重要 (Major): X 个
- 一般 (Minor): X 个
- 轻微 (Trivial): X 个

性能测试结果:
- 平均响应时间: XXXms
- 并发用户支持: XXX
- 内存使用峰值: XXXMB
- CPU使用峰值: XX%
```

### Bug报告模板
```
Bug ID: BUG_001
发现时间: 2025-01-XX
发现人员: XXX
Bug标题: 视频播放URL过期导致播放中断
严重程度: Major
优先级: P1

复现步骤:
1. 登录学员账号
2. 开始播放长视频(8小时)
3. 播放到第7小时时暂停
4. 等待2小时后继续播放

预期结果: 视频正常继续播放
实际结果: 提示URL过期，播放中断

影响范围: 所有长视频播放
修复建议: 优化URL过期检测机制，延长缓冲时间
```

---

## 🔧 测试工具推荐

### 自动化测试工具
- **Jest** - JavaScript单元测试
- **Cypress** - 端到端测试
- **Playwright** - 跨浏览器测试
- **Artillery** - 性能压力测试
- **Postman** - API接口测试

### 监控工具
- **Sentry** - 错误监控
- **LogRocket** - 用户行为录制
- **New Relic** - 性能监控
- **DataDog** - 系统监控

### 安全测试工具
- **OWASP ZAP** - 安全漏洞扫描
- **Burp Suite** - Web应用安全测试
- **SQLMap** - SQL注入检测

---

## 📈 持续改进

### 测试质量提升
1. **定期回顾测试用例有效性**
2. **根据生产Bug更新测试策略**
3. **优化自动化测试覆盖率**
4. **建立测试最佳实践文档**

### 团队能力建设
1. **测试技能培训**
2. **Bug分析会议**
3. **测试工具使用培训**
4. **质量意识提升**

---

## 🎉 结语

这套完整的测试用例涵盖了考研线上教育平台的所有核心功能模块，通过系统性的测试设计，能够有效发现潜在的bug和性能问题。建议按照优先级逐步实施，并根据实际发现的问题持续优化测试策略。

**关键成功要素:**
- ✅ 全面的功能覆盖
- ✅ 严格的权限边界测试  
- ✅ 完善的异常处理验证
- ✅ 充分的性能压力测试
- ✅ 持续的质量改进机制

通过执行这套测试用例，您将能够显著提升系统的稳定性、安全性和用户体验！ 